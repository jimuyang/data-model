<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script type=text/javascript src="https://webapi.amap.com/maps?v=1.3&key=08ba53e59d9200af1a65f9d5e996b032"></script>
</head>

<body>
  <div id="app"></div>
  <!-- built files will be auto injected -->
</body>
<script>
  // 加載Amap
  var loadmap = function () {
    // eslint-disable-next-line
    const mapObj = new AMap.Map('amapBlock')
    // eslint-disable-next-line
    mapObj.plugin(['AMap.Geolocation'], () => {
      // eslint-disable-next-line
      const geolocation = new AMap.Geolocation({
        enableHighAccuracy: true, // 是否使用高精度定位，默认:true
        timeout: 10000, // 超过10秒后停止定位，默认：无穷大
        maximumAge: 0, // 定位结果缓存0毫秒，默认：0
        convert: true // 自动偏移坐标，偏移后的坐标为高德坐标，默认：true
      })
      geolocation.getCurrentPosition()
      // 返回定位信息
      // eslint-disable-next-line
      AMap.event.addListener(geolocation, 'complete', (result) => {
        // eslint-disable-next-line
        this.regeocoder(result.position.lng, result.position.lat)
        console.log('succ', result)
      })
      // 返回定位出错信息
      // eslint-disable-next-line
      AMap.event.addListener(geolocation, 'error', (result) => {
        console.log('fail', result)
      })
    })
  }
  // 逆地理编码，根据经纬度获取详细地址信息
  var regeocoder = function (lng, lat) {
    let geocoder
    // eslint-disable-next-line
    AMap.service('AMap.Geocoder', () => {
      // eslint-disable-next-line
      geocoder = new AMap.Geocoder({})
    })
    // eslint-disable-next-line
    const lanlat = new AMap.LngLat(lng, lat)
    const lnglatXY = [lanlat.getLng(), lanlat.getLat()]
    geocoder.getAddress(lnglatXY, (status, result) => {
      if (status === 'complete' && result.info === 'OK') {
        /* this.eventDetailAddress = result.regeocode.formattedAddress */
        /* alert(result); */
        var obj = result.regeocode.addressComponent
        // eslint-disable-next-line no-unused-vars
        var props = ''
        // 开始遍历
        for (var p in obj) {
          // 方法
          if (typeof (obj[p]) === 'function') {
            // obj[p]();
          } else {
            // p 为属性名称，obj[p]为对应属性的值
            props += p + '=' + obj[p] + ';  '
          }
        }
        // 最后显示所有的属性
        this.eventDetailAddress = obj.province + obj.district + obj.township + obj.street + obj.streetNumber + obj.building
      }
    })
  }

  loadmap()
</script>

</html>
